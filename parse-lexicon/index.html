<!DOCTYPE html>
<html>
  <head>
    <script src='greek-helpers.js'></script>
    <script src='lexicon-to-json.js'></script>
    <meta charset="utf-8">
  </head>

<body>
  <div id='downloadStuff' style="display: none">
    <p>You are only seeing a preview of the data. Please click <a id="downloadLink">Download</a> to save it to your computer.
    </p>
  </div>
  <div id='JSONoutput'></div>
  <script>
  const libraryName = "AbbotSmithData";

  function activateDownload(data) {
    var myBlob = new Blob([data], {type: "text/plain"});

    var url = window.URL.createObjectURL(myBlob);
    var anchor = document.getElementById("downloadLink");
    anchor.href = url;
    anchor.download = libraryName + ".js";

    document.getElementById("downloadStuff").style.display = "block";
  }

  window.onload = function () {
    let lexiconURL = "lexicon.xml"; // ?lexicon= overwrites this
    const urlParams = new URLSearchParams(window.location.search);
    lexiconURL = (urlParams.get("lexicon") || lexiconURL);
    
    let outputNode = document.getElementById("JSONoutput");
    let output = null;
    
    encodeLexicon(lexiconURL)
      .then((data) => {
        let jsonData = JSON.stringify(data).replace(/,/g, ", ");
        output =
"/*\n\
This file is autogenerated.\n\
You must specify charset='utf-8' either a) on the script tag or b) for the entire page.\n\
*/\n";
        output = output + "const " + libraryName + " = " + jsonData + ";";
        activateDownload(output);
        })
      .catch ((error) => {
        output = error.toString();
        console.log(error);
        })
      .then (() => {
        outputNode.innerHTML = output.slice(0, 10000);
        });
    };
  </script>
</body>

</html>
